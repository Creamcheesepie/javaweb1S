<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.javaweb1S.dao.MessageDAO">

	<select id="getAllMessageList" resultType="com.spring.javaweb1S.vo.MessageVO">
		select
			A.msg_idx, 
			A.title,
			A.m_idx,
			A.receive_m_idx,
			B.nickName,
			A.sdate,
			A.readSw	
		from 
			message2 A, member2 B 
		where
			(A.receive_m_idx=B.m_idx and A.m_idx=#{m_idx})
			or
			(A.m_idx=B.m_idx and A.receive_m_idx=#{m_idx})
		order by A.msg_idx desc limit #{vo.sin} , #{vo.pageSize}; 
	</select>
	
	<select id="getSendMessage" resultType="com.spring.javaweb1S.vo.MessageVO">
	 select
	 	A.*,
	 	B.nickName,
	 	C.name as category_name
	 from
	 	message2 A,member2 B, message2_category C
	 where
	 	A.receive_m_idx = B.m_idx
	 	and
	 	A.msg_category = c.msg_category
	 	and
	 	A.msg_idx=#{msg_idx}
	</select>
	
	<select id="getReceiveMessage" resultType="com.spring.javaweb1S.vo.MessageVO">
	 select
	 	A.*,
	 	B.nickName,
	 	C.name as category_name
	 from
	 	message2 A,member2 B, message2_category C
	 where
	 	A.m_idx = B.m_idx
	 	and
	 	A.msg_category = c.msg_category
	 	and
	 	A.msg_idx=#{msg_idx}
	</select>
	
	<select id="getMessageReceiverSearchList"  resultType="com.spring.javaweb1S.vo.MemberVO">
		select ${searchOption},m_idx from member2 where ${searchOption} like concat('%',#{searchStr},'%');
	</select>
	
	<select id="getMessageCategoryList" resultType="com.spring.javaweb1S.vo.MessageVO">
		select msg_category, name as category_name from message2_category;
	</select>
	
	<select id="getMessageSendList" resultType="com.spring.javaweb1S.vo.MessageVO">
		select 
			A.msg_idx,
			A.title,
			A.sdate,
			A.readSw,
			B.nickName,
			C.name as category_name
		from
			message2 A, member2 B, message2_category C
		where
			A.receive_m_idx = B.m_idx
			and
			A.m_idx = ${m_idx}
			and
			A.msg_category = C.msg_category
		order by msg_idx desc
		limit ${vo.sin}, ${vo.pageSize};
	</select>
	
	<select id="getMessageReceiveList" resultType="com.spring.javaweb1S.vo.MessageVO">
		select 
			A.msg_idx,
			A.title,
			A.sdate,
			A.readSw,
			B.nickName,
			C.name as category_name
		from
			message2 A, member2 B, message2_category C
		where
			A.m_idx = B.m_idx
			and
			A.receive_m_idx = ${m_idx}
			and
			A.msg_category = C.msg_category
		order by msg_idx desc
		limit ${vo.sin}, ${vo.pageSize};
	</select>
	<select id="getSenderInfo" resultType="com.spring.javaweb1S.vo.MessageVO">
		select
			A.msg_idx,
			A.title,
			A.content,
			A.m_idx,
			B.nickName,
			C.name as category_name
		from
			message2 A, member2 B, message2_category C
		where
			A.m_idx = B.m_idx
			and
			A.msg_idx=#{msg_idx}
			and
			A.msg_category = C.msg_category;
	</select>
	
	<select id="getReportList" resultType="com.spring.javaweb1S.vo.ReportVO">
		select
			A.rep_idx,
			A.title,
			A.takeSw,
			A.wdate,
			B.name as category_name
		from
			report2 A, report2_category B
		where
			A.rep_category = B.rep_category
			and
			A.m_idx = #{m_idx}
		order by rep_idx desc
		limit #{vo.sin}, #{vo.pageSize}
	</select>
	
	<select id="getReportCategoryList" resultType="com.spring.javaweb1S.vo.ReportVO">
		select rep_category,name as category_name,idxName from report2_category where tableName=#{tableName} order by rep_category desc;	
	</select>
	
	<select id="getMyReportByRep_idx" resultType="com.spring.javaweb1S.vo.ReportVO">
		select
		 	A.*,
		 	B.tableName,
		 	B.idxName,
		 	B.name as category_name
		 from 
		 	report2 A ,report2_category B 
		 where
		 	A.rep_category = B.rep_category
		 	and 
		 	A.rep_idx = #{rep_idx};
	</select>
	
	<select id="getBoardTitle" resultType="String">
		select title from board2 where boa_idx = #{vo.reported_idx};
	</select>
	
	<select id="getMemberNickName" resultType="String">
		select nickName from member2 where m_idx = #{vo.reported_idx};
	</select>
	
	<select id="getReplyContent" resultType="String">
		select content from board2_reply where rep_idx = #{vo.reported_idx};
	</select>
	

	<insert id="setSendMessage">
		insert into message2 values(default,#{vo.m_idx},#{vo.receive_m_idx},#{vo.title},#{vo.content},default,null,null,#{vo.msg_category},null); 
	</insert>
	
	<insert id="setSendReport">
		insert into report2 values(default,#{vo.m_idx},#{vo.rep_category},#{vo.reported_idx},#{vo.title},#{vo.content},default,null,null,null,null);
	</insert>
	
	
	<update id="setReadSwOn">
		update message2 set readSw = 1 where msg_idx = #{msg_idx};
	</update>
	

</mapper>